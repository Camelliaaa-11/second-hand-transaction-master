@startuml ç³»ç»Ÿæ•´ä½“æ¶æ„å›¾
!theme plain
skinparam linetype ortho
skinparam packageStyle rectangle

title äºŒæ‰‹äº¤æ˜“å¹³å° - åˆ†å±‚æ¶æ„ä¸æœåŠ¡è§£è€¦è®¾è®¡

'==================================================
' ç¬¬ä¸€å±‚ï¼šå‰ç«¯å±•ç¤ºå±‚ (Presentation Layer)
' èŒè´£ï¼šç”¨æˆ·ç•Œé¢å±•ç¤ºã€ç”¨æˆ·äº¤äº’ã€è·¯ç”±ç®¡ç†
' è€¦åˆåº¦ï¼šä½è€¦åˆ - ä»…ä¾èµ–APIå®¢æˆ·ç«¯ï¼Œä¸ç›´æ¥è®¿é—®åç«¯
'==================================================
package "å‰ç«¯å±•ç¤ºå±‚ (Presentation Layer)" #E8F5E9 {
  
  package "é¡µé¢ç»„ä»¶ (Views)" {
    [Home.vue\né¦–é¡µ] as Home
    [Detail.vue\nå•†å“è¯¦æƒ…] as Detail
    [Chat.vue\nèŠå¤©é¡µé¢] as Chat
    [Order.vue\nè®¢å•é¡µé¢] as Order
    [Mine.vue\næˆ‘çš„é¡µé¢] as Mine
    [Publish.vue\nå‘å¸ƒå•†å“] as Publish
  }
  
  package "é€šä¿¡å±‚ (Communication Layer)" {
    [axios\nHTTPå®¢æˆ·ç«¯] as HttpClient
    [socket.io-client\nWebSocketå®¢æˆ·ç«¯] as SocketClient
  }
  
  note right of HttpClient
    <b>èŒè´£ï¼š</b>
    - RESTful API è°ƒç”¨å°è£…
    - è¯·æ±‚/å“åº”æ‹¦æˆªå™¨
    - ç»Ÿä¸€é”™è¯¯å¤„ç†
    
    <b>è§£è€¦æ–¹å¼ï¼š</b>
    - é¢å‘æ¥å£ç¼–ç¨‹
    - ä¸å…³å¿ƒåç«¯å®ç°ç»†èŠ‚
  end note
}

'==================================================
' ç¬¬äºŒå±‚ï¼šåº”ç”¨æœåŠ¡å±‚ (Application Layer)
' èŒè´£ï¼šä¸šåŠ¡é€»è¾‘ç¼–æ’ã€APIè·¯ç”±ã€è¯·æ±‚åˆ†å‘
' è€¦åˆåº¦ï¼šä¸­ç­‰è€¦åˆ - ä¾èµ–ä¸šåŠ¡é€»è¾‘å±‚å’Œæ•°æ®è®¿é—®å±‚
'==================================================
package "åº”ç”¨æœåŠ¡å±‚ (Application Layer)" #FFF3E0 {
  
  package "REST API ç½‘å…³" {
    [ç”¨æˆ·è®¤è¯API\nç™»å½•/æ³¨å†Œ] as AuthAPI
    [å•†å“ç®¡ç†API\nCRUD] as ItemAPI
    [è®¢å•ç®¡ç†API\näº¤æ˜“ç®¡ç†] as OrderAPI
    [æ¶ˆæ¯ç®¡ç†API\nèŠå¤©å†å²] as MessageAPI
    [è®®ä»·ç®¡ç†API\nç ä»·é€»è¾‘] as BargainAPI
  }
  
  package "å®æ—¶é€šä¿¡æœåŠ¡" {
    [Flask-SocketIO\nWebSocketæœåŠ¡å™¨] as WebSocket
    [åœ¨çº¿ç”¨æˆ·ç®¡ç†\nä¼šè¯ç®¡ç†] as OnlineUsers
  }
  
  note right of "REST API ç½‘å…³"
    <b>è®¾è®¡æ¨¡å¼ï¼š</b>
    - ç½‘å…³æ¨¡å¼ (Gateway Pattern)
    - è¯·æ±‚è·¯ç”±
    - ç»Ÿä¸€è®¤è¯é‰´æƒ
    
    <b>è§£è€¦ä¼˜åŠ¿ï¼š</b>
    - APIç‰ˆæœ¬æ§åˆ¶ (/api/v1)
    - å‰åç«¯åˆ†ç¦»
    - æ˜“äºæ‰©å±•å’Œæµ‹è¯•
  end note
}

'==================================================
' ç¬¬ä¸‰å±‚ï¼šä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)
' èŒè´£ï¼šæ ¸å¿ƒä¸šåŠ¡è§„åˆ™ã€æ•°æ®å¤„ç†ã€äº‹åŠ¡ç®¡ç†
' è€¦åˆåº¦ï¼šä½è€¦åˆ - å•ä¸€èŒè´£åŸåˆ™ï¼Œå„æœåŠ¡ç‹¬ç«‹
'==================================================
package "ä¸šåŠ¡é€»è¾‘å±‚ (Domain Layer)" #E3F2FD {
  [ç”¨æˆ·æœåŠ¡\nUserService] as UserService
  [å•†å“æœåŠ¡\nItemService] as ItemService
  [è®¢å•æœåŠ¡\nOrderService] as OrderService
  [æ¶ˆæ¯æœåŠ¡\nMessageService] as MessageService
  [è®®ä»·æœåŠ¡\nBargainService] as BargainService
  
  note right of UserService
    <b>è®¾è®¡åŸåˆ™ï¼š</b>
    - å•ä¸€èŒè´£ (SRP)
    - å¼€é—­åŸåˆ™ (OCP)
    - ä¾èµ–å€’ç½® (DIP)
    
    <b>æœåŠ¡ç‰¹å¾ï¼š</b>
    - æ— çŠ¶æ€è®¾è®¡
    - åŸå­æ€§æ“ä½œ
    - å¯ç‹¬ç«‹æµ‹è¯•
    
    <b>è€¦åˆæ§åˆ¶ï¼š</b>
    - æœåŠ¡é—´é€šè¿‡æ¥å£é€šä¿¡
    - é¿å…ç›´æ¥ä¾èµ–å…·ä½“å®ç°
  end note
}

'==================================================
' ç¬¬å››å±‚ï¼šAIæ™ºèƒ½ä½“æœåŠ¡ (å¾®æœåŠ¡æ¶æ„)
' èŒè´£ï¼šæ™ºèƒ½è®®ä»·å†³ç­–ã€å¸‚åœºåˆ†æã€ç­–ç•¥æ¨è
' è€¦åˆåº¦ï¼šæä½è€¦åˆ - ç‹¬ç«‹éƒ¨ç½²ã€HTTPé€šä¿¡ã€å¯æ›¿æ¢
'==================================================
package "AIæ™ºèƒ½ä½“æœåŠ¡ (ç‹¬ç«‹å¾®æœåŠ¡)" #F3E5F5 {
  [Flask Agent API\nç«¯å£:5011] as AgentAPI
  [SellerAgent\nå–å®¶ç­–ç•¥] as SellerAgent
  [BuyerAgent\nä¹°å®¶ç­–ç•¥] as BuyerAgent
  [NegotiationSession\nè®®ä»·ä¼šè¯] as NegotiationSession
  [MarketData\nå¸‚åœºæ•°æ®åˆ†æ] as MarketData
  [BargainRules\nè®®ä»·è§„åˆ™å¼•æ“] as Rules
  
  note left of AgentAPI
    <b>å¾®æœåŠ¡ä¼˜åŠ¿ï¼š</b>
    - ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
    - æŠ€æœ¯æ ˆç‹¬ç«‹
    - æ•…éšœéš”ç¦»
    - ç‰ˆæœ¬ç‹¬ç«‹è¿­ä»£
    
    <b>è§£è€¦ç­–ç•¥ï¼š</b>
    - HTTP RESTé€šä¿¡
    - å¼‚æ­¥å¤„ç†å¯é€‰
    - æœåŠ¡é™çº§æœºåˆ¶
    - è¶…æ—¶ç†”æ–­ä¿æŠ¤
    
    <b>å¯æ›¿æ¢æ€§ï¼š</b>
    - å¯å‡çº§ä¸ºæœºå™¨å­¦ä¹ æ¨¡å‹
    - å¯æ¥å…¥ç¬¬ä¸‰æ–¹AIæœåŠ¡
    - æ”¯æŒA/Bæµ‹è¯•
  end note
}

'==================================================
' ç¬¬äº”å±‚ï¼šæ•°æ®æŒä¹…å±‚ (Data Persistence Layer)
' èŒè´£ï¼šæ•°æ®å­˜å‚¨ã€æ•°æ®è®¿é—®ã€äº‹åŠ¡ç®¡ç†
' è€¦åˆåº¦ï¼šä½è€¦åˆ - ORMæŠ½è±¡ã€æ•°æ®åº“æ— å…³æ€§
'==================================================
database "æ•°æ®æŒä¹…å±‚ (MySQL + ORM)" #FFEBEE {
  [users\nç”¨æˆ·è¡¨] as UsersTable
  [items\nå•†å“è¡¨] as ItemsTable
  [orders\nè®¢å•è¡¨] as OrdersTable
  [messages\næ¶ˆæ¯è¡¨] as MessagesTable
  [bargain_logs\nè®®ä»·è®°å½•è¡¨] as BargainLogsTable
  [categories\nåˆ†ç±»è¡¨] as CategoriesTable
  [favorites\næ”¶è—è¡¨] as FavoritesTable
  [reviews\nè¯„ä»·è¡¨] as ReviewsTable
  
  note right of UsersTable
    <b>æ•°æ®è®¿é—®å±‚è®¾è®¡ï¼š</b>
    - ORMæŠ½è±¡ (SQLAlchemy)
    - æ•°æ®åº“æ— å…³æ€§
    - è¿æ¥æ± ç®¡ç†
    
    <b>è§£è€¦ä¼˜åŠ¿ï¼š</b>
    - æ˜“äºåˆ‡æ¢æ•°æ®åº“
    - SQLæ³¨å…¥é˜²æŠ¤
    - äº‹åŠ¡è‡ªåŠ¨ç®¡ç†
  end note
}

'==================================================
' ä¾èµ–å…³ç³»å›¾ (Dependency Graph)
' éµå¾ªä¾èµ–å€’ç½®åŸåˆ™ï¼šé«˜å±‚ä¸ä¾èµ–ä½å±‚ï¼ŒåŒæ–¹ä¾èµ–æŠ½è±¡
'==================================================

'-- å‰ç«¯å±‚ä¾èµ– (ä½è€¦åˆ) --
Home -down-> HttpClient : ä¾èµ–æ³¨å…¥
Detail -down-> HttpClient : ä¾èµ–æ³¨å…¥
Chat -down-> HttpClient : ä¾èµ–æ³¨å…¥
Chat -down-> SocketClient : åŒå‘é€šä¿¡
Order -down-> HttpClient : ä¾èµ–æ³¨å…¥
Mine -down-> HttpClient : ä¾èµ–æ³¨å…¥
Publish -down-> HttpClient : ä¾èµ–æ³¨å…¥

'-- HTTPé€šä¿¡ (æ¾è€¦åˆ - RESTæ¥å£) --
HttpClient -down-> AuthAPI : <color:blue>RESTful\næ¾è€¦åˆ
HttpClient -down-> ItemAPI : <color:blue>RESTful\næ¾è€¦åˆ
HttpClient -down-> OrderAPI : <color:blue>RESTful\næ¾è€¦åˆ
HttpClient -down-> MessageAPI : <color:blue>RESTful\næ¾è€¦åˆ
HttpClient -down-> BargainAPI : <color:blue>RESTful\næ¾è€¦åˆ

'-- WebSocketé€šä¿¡ (æ¾è€¦åˆ - äº‹ä»¶é©±åŠ¨) --
SocketClient -down-> WebSocket : <color:green>WebSocket\näº‹ä»¶é©±åŠ¨
WebSocket -right-> OnlineUsers : çŠ¶æ€ç®¡ç†

'-- APIç½‘å…³åˆ°ä¸šåŠ¡é€»è¾‘ (ä¸­è€¦åˆ - æœåŠ¡è°ƒç”¨) --
AuthAPI -down-> UserService : æœåŠ¡è°ƒç”¨
ItemAPI -down-> ItemService : æœåŠ¡è°ƒç”¨
OrderAPI -down-> OrderService : æœåŠ¡è°ƒç”¨
MessageAPI -down-> MessageService : æœåŠ¡è°ƒç”¨
BargainAPI -down-> BargainService : æœåŠ¡è°ƒç”¨

'-- ä¸šåŠ¡é€»è¾‘åˆ°æ•°æ®å±‚ (ä½è€¦åˆ - ORMæŠ½è±¡) --
UserService -down-> UsersTable : <color:purple>ORMæŠ½è±¡\næ•°æ®åº“æ— å…³
ItemService -down-> ItemsTable : <color:purple>ORMæŠ½è±¡
OrderService -down-> OrdersTable : <color:purple>ORMæŠ½è±¡
MessageService -down-> MessagesTable : <color:purple>ORMæŠ½è±¡
BargainService -down-> BargainLogsTable : <color:purple>ORMæŠ½è±¡

'-- è·¨æœåŠ¡è°ƒç”¨ (æä½è€¦åˆ - å¾®æœåŠ¡é€šä¿¡) --
BargainService -right-> AgentAPI : <color:red><b>HTTPè¿œç¨‹è°ƒç”¨\nå¾®æœåŠ¡è§£è€¦\nå¯ç‹¬ç«‹éƒ¨ç½²

'-- AIæœåŠ¡å†…éƒ¨ä¾èµ– (æ¨¡å—åŒ–è®¾è®¡) --
AgentAPI -down-> SellerAgent : ç­–ç•¥å·¥å‚
AgentAPI -down-> BuyerAgent : ç­–ç•¥å·¥å‚
SellerAgent -down-> NegotiationSession : ä¼šè¯ç®¡ç†
BuyerAgent -down-> NegotiationSession : ä¼šè¯ç®¡ç†
NegotiationSession -right-> MarketData : æ•°æ®åˆ†æ
NegotiationSession -right-> Rules : è§„åˆ™å¼•æ“

'-- AgentæœåŠ¡æ•°æ®è®¿é—® (ç‹¬ç«‹æ•°æ®æº) --
AgentAPI -down-> UsersTable : <color:orange>è·¨æœåŠ¡\næ•°æ®æŸ¥è¯¢
AgentAPI -down-> ItemsTable : <color:orange>è·¨æœåŠ¡\næ•°æ®æŸ¥è¯¢
AgentAPI -down-> OrdersTable : <color:orange>è·¨æœåŠ¡\næ•°æ®æŸ¥è¯¢

'==================================================
' æ¶æ„è¯´æ˜æ³¨é‡Š
'==================================================

note as N1
  <b>ã€æ¶æ„å±‚æ¬¡ä¸è€¦åˆåº¦åˆ†æã€‘</b>
  
  <b>1. åˆ†å±‚æ¶æ„ (Layered Architecture)</b>
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  å±•ç¤ºå±‚ â†’ åº”ç”¨å±‚ â†’ ä¸šåŠ¡å±‚ â†’ æ•°æ®å±‚
  æ¯å±‚åªä¾èµ–ä¸‹ä¸€å±‚ï¼Œå•å‘ä¾èµ–ï¼Œé™ä½è€¦åˆ
  
  <b>2. è€¦åˆåº¦è¯„ä¼°</b>
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â€¢ <color:blue>å‰ç«¯-åç«¯ï¼š</color> æ¾è€¦åˆ (REST/WebSocketæ¥å£)
  â€¢ <color:green>API-ä¸šåŠ¡ï¼š</color> ä¸­è€¦åˆ (ç›´æ¥æœåŠ¡è°ƒç”¨)
  â€¢ <color:purple>ä¸šåŠ¡-æ•°æ®ï¼š</color> ä½è€¦åˆ (ORMæŠ½è±¡å±‚)
  â€¢ <color:red>ä¸»æœåŠ¡-AIæœåŠ¡ï¼š</color> æä½è€¦åˆ (å¾®æœåŠ¡æ¶æ„)
  
  <b>3. è§£è€¦è®¾è®¡äº®ç‚¹</b>
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  âœ… <b>å¾®æœåŠ¡åˆ†ç¦»ï¼š</b> AIæœåŠ¡ç‹¬ç«‹éƒ¨ç½² (ç«¯å£5011)
  âœ… <b>å‰åç«¯åˆ†ç¦»ï¼š</b> çº¯æ¥å£é€šä¿¡ï¼Œæ— é¡µé¢æ¸²æŸ“è€¦åˆ
  âœ… <b>ORMæŠ½è±¡ï¼š</b> å¯æ— ç—›åˆ‡æ¢æ•°æ®åº“ (MySQLâ†’PostgreSQL)
  âœ… <b>ä¾èµ–æ³¨å…¥ï¼š</b> å‰ç«¯ç»„ä»¶é€šè¿‡axios/socketæ³¨å…¥
  âœ… <b>æ¥å£éš”ç¦»ï¼š</b> æ¯ä¸ªAPIæ¨¡å—èŒè´£å•ä¸€
  
  <b>4. æ‰©å±•æ€§è®¾è®¡</b>
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ“Œ å¯æ¨ªå‘æ‰©å±•ï¼šAIæœåŠ¡å¯éƒ¨ç½²å¤šå®ä¾‹è´Ÿè½½å‡è¡¡
  ğŸ“Œ å¯çºµå‘æ‰©å±•ï¼šä¸šåŠ¡å±‚æœåŠ¡å¯æ‹†åˆ†ä¸ºæ›´å¤šå¾®æœåŠ¡
  ğŸ“Œ æŠ€æœ¯æ ˆè§£è€¦ï¼šå‰ç«¯å¯æ›¿æ¢ä¸ºReactã€åç«¯å¯è¿ç§»è‡³Go
end note

note as N2
  <b>ã€è®¾è®¡æ¨¡å¼åº”ç”¨ã€‘</b>
  
  â€¢ <b>ç½‘å…³æ¨¡å¼ (Gateway)ï¼š</b> REST APIç»Ÿä¸€å…¥å£
  â€¢ <b>ç­–ç•¥æ¨¡å¼ (Strategy)ï¼š</b> SellerAgent/BuyerAgent
  â€¢ <b>å·¥å‚æ¨¡å¼ (Factory)ï¼š</b> Agentåˆ›å»º
  â€¢ <b>è§‚å¯Ÿè€…æ¨¡å¼ (Observer)ï¼š</b> WebSocketäº‹ä»¶ç›‘å¬
  â€¢ <b>å•ä¾‹æ¨¡å¼ (Singleton)ï¼š</b> æ•°æ®åº“è¿æ¥æ± 
  â€¢ <b>ä»“å‚¨æ¨¡å¼ (Repository)ï¼š</b> ORMæ•°æ®è®¿é—®
end note

note as N3
  <b>ã€æ•…éšœéš”ç¦»ä¸é™çº§ã€‘</b>
  
  âš ï¸ AIæœåŠ¡æ•…éšœä¸å½±å“ä¸»ä¸šåŠ¡
  âš ï¸ è®¾ç½®è¶…æ—¶ç†”æ–­ (3ç§’)
  âš ï¸ é™çº§ç­–ç•¥ï¼šè¿”å›é»˜è®¤å»ºè®®
  âš ï¸ WebSocketæ–­çº¿è‡ªåŠ¨é‡è¿
end note

N1 -[hidden]right- N2
N2 -[hidden]right- N3

@enduml
